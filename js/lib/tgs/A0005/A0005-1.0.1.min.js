/* Copyright (c) 2013 TreSensa, Inc. All Rights Reserved. */
TGS.Adapters.A0005=function(){TGS.Adapters.A0005.superclass.constructor.call(this),this._mGameSecret="",this._mMoreGamesURL="http://www.games.com/search/?q=tresensa"},TGS.Adapters.A0005.prototype={supportsMicrotransactions:function(){return!0},costFactor:function(){return.1},priceAsFormattedString:function(a){return"$"+(a*this.costFactor()).toFixed(2)},logTransactionBeforePartnerRequest:function(){return!1},initialize:function(){window.GAMESAPI||TGS.Debug.Log(TGS.Debug.LOG_ERROR,"Games.com library has not been loaded"),this._mIsReady=!0,null!==this.onAdapterReady&&this.onAdapterReady.call()},requiredPartnerProperties:function(){return'"gamescom_game_id","gamescom_game_secret"'},connect:function(a){this._mGameSecret=a.gamescom_game_secret,GAMESAPI.beginGameSession(this._onBeginSuccess.bind(this),this._onBeginError.bind(this))},_onBeginSuccess:function(a){if(200!==a.statusCode)return TGS.Debug.Log(TGS.Debug.LOG_ERROR,"could not connect to Games.com: error code "+a.statusCode),void 0;GAMESAPI.setGameSecret(this._mGameSecret);var b=a.data.playerInfo.playerId;null!==this.onUserInfoAvailable&&this.onUserInfoAvailable.call(this,b)},_onBeginError:function(a){TGS.Debug.Log(TGS.Debug.LOG_ERROR,"could not connect to Games.com: "+a.statusText)},submitScore:function(){},achievementEarned:function(){},purchaseItem:function(a){if(TGS.BrowserDetect.isMobileDevice)return a.internalErrorMessage="on mobile",a.userErrorMessage="In-app purchases cannot be made from a mobile device. Please try again on a desktop computer. Items purchased on desktop will be available when playing on mobile using your Games.com account.",TGS.Microtransactions._PartnerPurchaseFailed(a),void 0;var b=a.item;GAMESAPI.TRANSACTION.startTransaction(b.price*this.costFactor(),a.item.id,b.title,this._purchaseItemCallback.bind(this,a),this._onPurchaseError.bind(this,a))},_purchaseItemCallback:function(a,b){a.partnerTransactionID=b.data.orderId,TGS.Debug.Log(TGS.Debug.LOG_INFO,"Games.com approved purchase of transaction "+a.transactionID),TGS.Microtransactions._PartnerPurchaseSuccessful(a)},_onPurchaseError:function(a,b){a.internalErrorMessage=b.statusCode+" - "+b.statusText,475===b.statusCode&&(a.userErrorMessage=""),TGS.Microtransactions._PartnerPurchaseFailed(a)}},extend(TGS.Adapters.A0005,TGS.PartnerBridge);