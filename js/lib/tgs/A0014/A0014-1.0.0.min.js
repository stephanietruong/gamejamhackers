/* Copyright (c) 2013 TreSensa, Inc. All Rights Reserved. */
TGS.Adapters.A0014=function(){TGS.Adapters.A0014.superclass.constructor.call(this),this._mAppID=null,this._mPurchaseSucceeded=!1},TGS.Adapters.A0014.prototype={supportsMicrotransactions:function(){return!0},costFactor:function(){return 10},priceAsFormattedString:function(a){return"$"+(a*this.costFactor()/100-.01).toFixed(2)},requiredPartnerProperties:function(){return'"playphone_game_id"'},initialize:function(){TGS.Debug.Log(TGS.Debug.LOG_INFO,"deferring PlayPhone library load"),this._mIsReady=!0,null!==this.onAdapterReady&&this.onAdapterReady.call()},connect:function(a){this._mAppID=a.playphone_game_id;var b="production",c="",d="http://html5sdk.galaxy.gs/PSGN.js?env="+b+"&app_id="+this._mAppID+c;TGS.Debug.Log(TGS.Debug.LOG_INFO,"loading PlayPhone library... "+d),head.js(d,this.onLibraryLoad.bind(this))},onLibraryLoad:function(){TGS.Debug.Log(TGS.Debug.LOG_INFO,"PlayPhone library loaded successfully"),playphone.PSGN.Auth.onlogin(this._onAuth.bind(this))},_onAuth:function(){return(userID=TGS.localStorage.getItem("uguid"))?(null!==this.onUserInfoAvailable&&this.onUserInfoAvailable.call(this,userID),void 0):(TGS.Debug.Log(TGS.Debug.LOG_ERROR,"uguid in local storage is invalid: "+userID),void 0)},_onGetData:function(){null!==this.onUserInfoAvailable&&this.onUserInfoAvailable.call(this,userID)},showLeaderboard:function(){},submitScore:function(){},submitScoreAndShow:function(a){var b=a.leaderboardID?a.leaderboardID:0,c=TGS.Leaderboard.GetLeaderboardDescriptor(b);if(null===c)return TGS.Debug.Log(TGS.Debug.LOG_ERROR,"no data found for leaderboard "+a.leaderboardID),void 0;var d=c.partnerLeaderboardID;return null===d?(TGS.Debug.Log(TGS.Debug.LOG_ERROR,"no PlayPhone id found for leaderboard "+a.leaderboardID),void 0):(playphone.PSGN.Player("leaderboard",d,a.score),void 0)},purchaseItem:function(a){this._mPurchaseSucceeded=!1;var b=a.item.partnerProductID;return b?(TGS.Debug.Log(TGS.Debug.LOG_VERBOSE,"calling playphone.PSGN.Billing with product ID "+b+"..."),playphone.PSGN.Billing(b,this._purchaseResponse.bind(this,a),this._purchaseCancel.bind(this,a)),void 0):(TGS.Debug.Log(TGS.Debug.LOG_ERROR,"no PlayPhone IAP id found for item "+a.item.id),TGS.Microtransactions._PartnerPurchaseFailed(a),void 0)},_purchaseResponse:function(a,b){return TGS.Debug.Log(TGS.Debug.LOG_VERBOSE,"playphone.PSGN.Billing purchase callback received, response is: "+b),"string"!=typeof b?(TGS.Microtransactions._PartnerPurchaseFailed(a),void 0):(TGS.Debug.Log(TGS.Debug.LOG_INFO,"billing request assumed successful, response string: "+b),a.partnerTransactionID=b.toString(),TGS.Microtransactions._PartnerPurchaseSuccessful(a),this._mPurchaseSucceeded=!0,void 0)},_purchaseCancel:function(a,b){TGS.Debug.Log(TGS.Debug.LOG_VERBOSE,"playphone.PSGN.Billing cancel callback received, response is: "+b),this._mPurchaseSucceeded||(a.userErrorMessage="",a.internalErrorMessage="user cancel",TGS.Microtransactions._PartnerPurchaseFailed(a))}},extend(TGS.Adapters.A0014,TGS.PartnerBridge);