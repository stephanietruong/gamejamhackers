/* Copyright (c) 2013 TreSensa, Inc. All Rights Reserved. */
TGS.Adapters.A0021=function(){TGS.Adapters.A0021.superclass.constructor.call(this),this._mTestMode=!1,this._mAllowSandboxMode=!1,window.WinJS&&(WinJS.Binding.optimizeBindingReferences=!0,this.currentWinApp=null)},TGS.Adapters.A0021.prototype={supportsMicrotransactions:function(){return!0},costFactor:function(){return 10},priceAsFormattedString:function(a){return"$"+(a*this.costFactor()/100-.01).toFixed(2)},requiredPartnerProperties:function(){return""},initialize:function(){if(this._mIsReady=!0,null!==this.onAdapterReady&&this.onAdapterReady.call(),null!=window.TGE){var a=TGE.Game.GetInstance();null!=a&&(a.scaleToFitOnDesktop=!0,a.centerHorizontallyOnDesktop=!0,a.centerVerticallyOnDesktop=!0)}TGS.Debug.Log(TGS.Debug.LOG_INFO,"Windows Store adapter initialized.")},connect:function(){if(TGS.Debug.Log(TGS.Debug.LOG_INFO,"Windows Store adapter connecting..."),this.currentWinApp=GameConfig.DEBUG||!GameConfig.PROD_ENV?Windows.ApplicationModel.Store.CurrentAppSimulator:Windows.ApplicationModel.Store.CurrentApp,null!=this.currentWinApp){{this.currentWinApp.licenseInformation}TGS.Debug.Log(TGS.Debug.LOG_INFO,"Windows Store adapter is connected and we got license info"),this.getLoginStatus()}else TGS.Debug.Log(TGS.Debug.LOG_INFO,"Windows Store adapter init failed"),this._mIsReady=!1},onPurchaseSuccess:function(a){var b=this.currentWinApp.licenseInformation;if(null!=b){{b.productLicenses.lookup(a).isActive}TGS.Debug.Log(TGS.Debug.LOG_INFO,"Windows Store purchase accepted for "+a);var c=TGS.Microtransactions._PendingRequest;null!=c&&(c.partnerTransactionID=a,TGS.Microtransactions._PartnerPurchaseSuccessful(c))}},onPurchaseFailed:function(a){TGS.Debug.Log(TGS.Debug.LOG_INFO,"Windows Store purchase failed "+a);var b=TGS.Microtransactions._PendingRequest;null!=b&&(b.internalErrorMessage="Windows Store status failed",TGS.Microtransactions._PartnerPurchaseFailed(b))},purchaseItem:function(a){TGS.Debug.Log(TGS.Debug.LOG_INFO,"Windows Store purchase request for "+a.item.id+" ("+a.item.partnerProductID+").");var b=a.item.partnerProductID;null!=b&&b.length>0?null!=this.currentWinApp?this.currentWinApp.requestProductPurchaseAsync(b,!1).then(this.onPurchaseSuccess.bind(this,b),this.onPurchaseFailed.bind(this,b)):TGS.Debug.Log(TGS.Debug.LOG_ERROR,"Windows Store purchase not initialized"):(TGS.Debug.Log(TGS.Debug.LOG_INFO,"Windows Store purchase request cannot be fulfilled no product id specified"),this.onPurchaseFailed(b))},advertising_getAdServerURL:function(){return"http://games.tresensa.com/ad/index.html"}},extend(TGS.Adapters.A0021,TGS.PartnerBridge);