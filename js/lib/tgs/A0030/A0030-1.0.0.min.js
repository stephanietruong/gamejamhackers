/* Copyright (c) 2013 TreSensa, Inc. All Rights Reserved. */
TGS.Adapters.A0030=function(){TGS.Adapters.A0030.superclass.constructor.call(this),this._mTestMode=!1,this._mAllowSandboxMode=!1,this._isPurchaseAllowed=!0,TGS.DataStore._sSaveToLocalStorage=!0,TGS.DataStore._sSaveToTGSServer=!1},TGS.Adapters.A0030.prototype={loginIcon:function(){return TGS._IMAGES_LOCATION+"ios_login.png"},supportsMicrotransactions:function(){return!0},allowsMicrotransactions:function(){return TGS.Debug.Log(TGS.Debug.LOG_VERBOSE,"InAppPurchaseManager - allowsMicrotransactions: "+this._isPurchaseAllowed),this._isPurchaseAllowed},costFactor:function(){return 10},priceAsFormattedString:function(a){return"$"+(a*this.costFactor()/100-.01).toFixed(2)},requiredPartnerProperties:function(){return""},initialize:function(){TGS.Debug.Log(TGS.Debug.LOG_INFO,"WindowsPhoneAdapter.initialize initializing Windows 8 Phone Store Adapter"),window.plugins&&(window.plugins.inAppPurchaseManager.onPurchased=function(a,b,c){TGS.Debug.Log(TGS.Debug.LOG_INFO,"Windows Phone Store approved purchase of "+b);var d=TGS.Microtransactions._PendingRequest;d?b!=d.item.partnerProductID?TGS.Debug.Log(TGS.Debug.LOG_ERROR,"we expected product "+d.item.partnerProductID+" but got "+b):(TGS.Debug.Log(TGS.Debug.LOG_VERBOSE,"transactionIdentifier: "+a),TGS.Debug.Log(TGS.Debug.LOG_VERBOSE,"transactionReceipt: "+c),d.partnerTransactionID=a,TGS.Microtransactions._PartnerPurchaseSuccessful(d)):TGS.Debug.Log(TGS.Debug.LOG_ERROR,"Windows Phone Store onPurchased has no pending request")},window.plugins.inAppPurchaseManager.onFailed=function(a,b){TGS.Debug.Log(TGS.Debug.LOG_ERROR,"Windows Phone Store denied purchase: "+b);var c=TGS.Microtransactions._PendingRequest;c&&("UserCancelled"===b&&(c.userErrorMessage=""),c.internalErrorMessage=b+" "+a,TGS.Microtransactions._PartnerPurchaseFailed(c))},window.plugins.inAppPurchaseManager.onRestored=function(a){TGS.Debug.Log(TGS.Debug.LOG_VERBOSE,"Windows Phone Store restoring purchases: "+a);for(var b=a.split(" "),c=0;c<b.length;c++){for(var d=b[c],e=!1,f=0;f<TGS.Microtransactions._sIAPProducts.length&&!e;f++){var g=TGS.Microtransactions._sIAPProducts[f];g.partnerProductID==d&&(TGS.Microtransactions._RestorePurchaseCallback(g.id),e=!0)}e||TGS.Debug.Log(TGS.Debug.LOG_ERROR,"unknown Windows Phone SKU "+d)}TGS.Microtransactions._RestorePurchasesDone(!0)},window.plugins.inAppPurchaseManager.onRestoreCompletedTransactionsFailed=function(a,b){TGS.Debug.Log(TGS.Debug.LOG_ERROR,"Windows Phone Store restore purchases error: "+b),TGS.Microtransactions._RestorePurchasesDone(!1)},window.plugins.inAppPurchaseManager.canPurchase(this.userAllowsPurchase.bind(this))),this._mIsReady=!0,null!==this.onAdapterReady&&this.onAdapterReady.call(),TGS.Debug.Log(TGS.Debug.LOG_INFO,"Windows Phone WP8 adapter initialized.")},connect:function(){TGS.Debug.Log(TGS.Debug.LOG_INFO,"Windows Phone WP8 adapter connecting..."),this.getLoginStatus()},userAllowsPurchase:function(a){this._isPurchaseAllowed=a,TGS.Debug.Log(TGS.Debug.LOG_VERBOSE,"InAppPurchaseManager.canPurchase WP8: "+this._isPurchaseAllowed)},purchaseItem:function(a){TGS.Debug.Log(TGS.Debug.LOG_INFO,"Windows Phone purchase request for "+a.item.id+" ("+a.item.partnerProductID+").");var b=a.item.partnerProductID,c=1;null!=b&&b.length>0?window.plugins.inAppPurchaseManager.makePurchase(b,c):(TGS.Debug.Log(TGS.Debug.LOG_ERROR,"do not have a Windows Phone item sku for "+a.item.id),a.internalErrorMessage="unknown product sku",TGS.Microtransactions._PartnerPurchaseFailed(a))},restorePurchases:function(){TGS.Debug.Log(TGS.Debug.LOG_VERBOSE,"InAppPurchaseManager calling restoreCompletedTransactions..."),window.plugins.inAppPurchaseManager.restoreCompletedTransactions()}},extend(TGS.Adapters.A0030,TGS.PartnerBridge);