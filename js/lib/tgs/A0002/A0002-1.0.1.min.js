/* Copyright (c) 2013 TreSensa, Inc. All Rights Reserved. */
TGS.Adapters.A0002=function(){TGS.Adapters.A0002.superclass.constructor.call(this),TGS.DataStore._sSaveToLocalStorage=!0,TGS.DataStore._sSaveToTGSServer=!1},TGS.Adapters.A0002.prototype={loginIcon:function(){return TGS._IMAGES_LOCATION+"android_login.png"},supportsMicrotransactions:function(){return!0},costFactor:function(){return 10},priceAsFormattedString:function(a){return"$"+(a*this.costFactor()/100-.01).toFixed(2)},requiredPartnerProperties:function(){return""},initialize:function(){this._mIsReady=!0,null!==this.onAdapterReady&&this.onAdapterReady.call(),TGS.Debug.Log(TGS.Debug.LOG_INFO,"Google Play adapter initialized.")},onInitSuccess:function(){TGS.Debug.Log(TGS.Debug.LOG_INFO,"Google Play adapter connected."),this.updateLocalStorageData(),this.getLoginStatus()},onInitFailed:function(a){TGS.Debug.Log(TGS.Debug.LOG_INFO,"Google Play adapter init fails with "+a),this._mIsReady=!1},connect:function(){TGS.Debug.Log(TGS.Debug.LOG_INFO,"Google Play adapter connecting..."),inappbilling.init(this.onInitSuccess.bind(this),this.onInitFailed.bind(this)),this._mAdxId=CordovaConfig&&CordovaConfig.ADS&&CordovaConfig.ADS.ADX_PLACEMENT_ID,window.plugins&&window.plugins.adxPlugin&&this._mAdxId&&plugins.adxPlugin.init(this._mAdxId)},onPurchaseSuccess:function(a){TGS.Debug.Log(TGS.Debug.LOG_INFO,"Google Play purchase accepted. "+JSON.stringify(a));var b=TGS.Microtransactions._PendingRequest;if(null!=b){b.partnerTransactionID=a;var c=TGS.Microtransactions.GetIAPProduct(b.item.id);if(c.consumable){TGS.Debug.Log(TGS.Debug.LOG_INFO,"Google Play purchase was consumable. Consuming.");var d=c.partnerProductID;inappbilling.consumePurchase(this.onConsumePurchaseSuccess.bind(this),this.onConsumePurchaseFailed.bind(this),d)}TGS.Microtransactions._PartnerPurchaseSuccessful(b)}},restorePurchases:function(){TGS.Debug.Log(TGS.Debug.LOG_VERBOSE,"Google Play calling inappbilling.getPurchases"),inappbilling.getPurchases(function(a){TGS.Debug.Log(TGS.Debug.LOG_VERBOSE,"Google Play getPurchases callback",a);var b,c;for(b=0;b<a.length;b++)c=TGS.Microtransactions.GetIAPProduct(a[b],"partnerProductID"),c?(TGS.Debug.Log(TGS.Debug.LOG_VERBOSE,"Google Play found matching item for SKU, restoring...",a[b]),c.consumable&&(TGS.Debug.Log(TGS.Debug.LOG_INFO,"Google Play consumable item already owned, consuming it before restoring: "+a[b]),inappbilling.consumePurchase(this.onConsumePurchaseSuccess.bind(this),this.onConsumePurchaseFailed.bind(this),a[b])),TGS.Microtransactions._RestorePurchaseCallback(c.id)):TGS.Debug.Log(TGS.Debug.LOG_VERBOSE,"Google Play did not find matching item for SKU",a[b]);TGS.Microtransactions._RestorePurchasesDone(!0)}.bind(this))},onPurchaseFailed:function(a){var b=TGS.Microtransactions._PendingRequest;if(null!=b)if(a.indexOf("Already Owned")>=0){TGS.Debug.Log(TGS.Debug.LOG_INFO,"Google Play purchase already owned, restoring it");var c=TGS.Microtransactions.GetIAPProduct(b.item.id);if(c.consumable){var d=c.partnerProductID;TGS.Debug.Log(TGS.Debug.LOG_INFO,"Google Play consumable item already owned, consuming it before restoring: "+d),inappbilling.consumePurchase(this.onConsumePurchaseSuccess.bind(this),this.onConsumePurchaseFailed.bind(this),d)}TGS.Microtransactions._PartnerPurchaseSuccessful(b)}else TGS.Debug.Log(TGS.Debug.LOG_INFO,"Google Play purchase failed "+a),b.internalErrorMessage="Google Play status: "+a.status,TGS.Microtransactions._PartnerPurchaseFailed(b)},onConsumePurchaseSuccess:function(){TGS.Debug.Log(TGS.Debug.LOG_INFO,"Google Play consume purchase success.")},onConsumePurchaseFailed:function(a){TGS.Debug.Log(TGS.Debug.LOG_INFO,"Google Play consume purchase failed "+a)},purchaseItem:function(a){TGS.Debug.Log(TGS.Debug.LOG_INFO,"Google Play purchase request for "+a.item.id+" ("+a.item.partnerProductID+").");var b=a.item.partnerProductID;inappbilling.buy(this.onPurchaseSuccess.bind(this),this.onPurchaseFailed.bind(this),b)},advertising_injectAd:function(a,b){if(this._mAdxId){var c=b.clientWidth,d=b.clientHeight,e="undefined"==typeof a.x?(b.clientWidth-a.width)/2:a.x,f="undefined"==typeof a.y?(b.clientHeight-a.height)/2:a.y,g=90===Math.abs(window.orientation)?"landscape":"portrait";plugins.adxPlugin.getAd(c,d,e,f,g,function(){})}},advertising_injectInterstitial:function(a){loadingOverlay=TGS.LoadingOverlay(),plugins.adxPlugin.showInterstitial(function(){loadingOverlay.parentNode.removeChild(loadingOverlay),a.closeCallback&&a.closeCallback()})},advertising_closeAd:function(){this._mAdxId&&plugins.adxPlugin.closeAd()},analytics_getProviders:function(){return[TGS.Analytics.NativeGoogleAnalyticsProvider]}},extend(TGS.Adapters.A0002,TGS.PartnerBridge);