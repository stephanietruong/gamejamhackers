/**
  Font.js v2012.01.25
  (c) Mike "Pomax" Kamermans, 2012
  Licensed under MIT ("expat" flavour) license.
  Hosted on http://github.com/Pomax/Font.js
**/

(function(a){if(!Object.defineProperty){throw ("Font.js requires Object.defineProperty, which this browser does not support.")}if(!document.createElement("canvas").getContext){throw ("Font.js requires <canvas> and the Canvas2D API, which this browser does not support.")}(function(h){try{var c=new Uint8Array(1);return}catch(i){}function g(j,e){return this.slice(j,e)}function d(l,j){var e,k=l.length;if(arguments.length<2){j=0}for(e=0;e<k;++e,++j){this[j]=l[e]&255}}function f(j){var e,k;if(typeof j==="number"){e=new Array(j);for(k=0;k<j;++k){e[k]=0}}else{e=j.slice(0)}e.subarray=g;e.buffer=e;e.byteLength=e.length;e.set=d;if(typeof j==="object"&&j.buffer){e.buffer=j.buffer}return e}h.Uint8Array=f;h.Uint32Array=f;h.Int32Array=f}(a));(function(d){if(d.opera){return}if("response" in XMLHttpRequest.prototype||"mozResponseArrayBuffer" in XMLHttpRequest.prototype||"mozResponse" in XMLHttpRequest.prototype||"responseArrayBuffer" in XMLHttpRequest.prototype){return}var c;if(d.VBArray){c=function(){return new Uint8Array(new VBArray(this.responseBody).toArray())}}else{c=function(){this.responseBody}}Object.defineProperty(XMLHttpRequest.prototype,"response",{get:c})}(a));if(!a.btoa){a.btoa=function(l){var g="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var f,e,d,p,o,n,m,q,k=0,s=0,j="",h=[];if(!l){return l}do{f=l.charCodeAt(k++);e=l.charCodeAt(k++);d=l.charCodeAt(k++);q=f<<16|e<<8|d;p=q>>18&63;o=q>>12&63;n=q>>6&63;m=q&63;h[s++]=g.charAt(p)+g.charAt(o)+g.charAt(n)+g.charAt(m)}while(k<l.length);j=h.join("");var c=l.length%3;return(c?j.slice(0,c-3):j)+"===".slice(c||3)}}function b(){}b.prototype.fontFamily="fjs"+(999999*Math.random()|0);b.prototype.url="";b.prototype.format="";b.prototype.data="";b.prototype.base64="AAEAAAAKAIAAAwAgT1MvMgAAAAAAAACsAAAAWGNtYXAAAAAAAAABBAAAACxnbHlmAAAAAAAAATAAAAAQaGVhZAAAAAAAAAFAAAAAOGhoZWEAAAAAAAABeAAAACRobXR4AAAAAAAAAZwAAAAIbG9jYQAAAAAAAAGkAAAACG1heHAAAAAAAAABrAAAACBuYW1lAAAAAAAAAcwAAAAgcG9zdAAAAAAAAAHsAAAAEAAEAAEAZAABAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAAAAABAAMAAQAAAAwABAAgAAAABAAEAAEAAABB//8AAABB////wAABAAAAAAABAAAAAAAAAAAAAAAAMQAAAQAAAAAAAAAAAABfDzz1AAAgAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAEAAgAAAAAAAAABAAAAAQAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAQAAAAAAAAAAAAAAAAAIAAAAAQAAAAIAAQABAAAAAAACAAAAAAAAAAAAAAAAAAAAAAAAAAIAHgADAAEECQABAAAAAAADAAEECQACAAIAAAAAAAEAAAAAAAAAAAAAAAAAAA==";b.prototype.metrics={quadsize:0,leading:0,ascent:0,descent:0,weightclass:400};b.prototype.systemfont=false;b.prototype.loaded=false;b.prototype.onload=function(){};b.prototype.onerror=function(){};b.prototype.canvas=false;b.prototype.context=false;b.prototype.validate=function(h,f,i,d,g){if(g!==false&&g<0){this.onerror("Requested system font '"+this.fontFamily+"' could not be loaded (it may not be installed).");return}var c=document.defaultView.getComputedStyle(h,"");var e=c.getPropertyValue("width").replace("px","");if(e>0){document.head.removeChild(f);document.body.removeChild(h);this.loaded=true;this.onload()}else{setTimeout(function(){d.validate(h,f,i,d,g===false?false:g-50)},50)}};b.prototype.ondownloaded=function(){var w=function(e){return String.fromCharCode(e)};var g=function(N){if(N<256){return w(0)+w(N)}var i=N>>8;var e=N&255;return w(i)+w(e)};var u=function(e){if(e<0){e=4294967295+e+1}return parseInt(e,10).toString(16)};var s=function(i,e){return 256*i+e};var x=function(N,e){var i=N>>7===1,O;N=N&127;O=256*N+e;if(!i){return O}return O-32768};var I=function(O,N,i,e){return 16777216*O+65536*N+256*i+e};var v=function(e){this.onerror(e)};var q=w(0)+w(1)+w(0)+w(0);var l="OTTO";var K=this.data;var j=w(K[0])+w(K[1])+w(K[2])+w(K[3]);var p=(j===q);var m=(p?false:j===l);if(p){this.format="truetype"}else{if(m){this.format="opentype"}else{v("Error: file at "+this.url+" cannot be interpreted as OpenType font.");return}}var t=s(K[4],K[5]),A=12,c,h=A+16*t,r={},M;for(c=A;c<h;c+=16){M=w(K[c])+w(K[c+1])+w(K[c+2])+w(K[c+3]);r[M]={name:M,checksum:I(K[c+4],K[c+5],K[c+6],K[c+7]),offset:I(K[c+8],K[c+9],K[c+10],K[c+11]),length:I(K[c+12],K[c+13],K[c+14],K[c+15])}}var E=function(e){if(!r[e]){v("Error: font is missing the required OpenType '"+e+"' table.");return false}return e};M=E("head");if(M===false){return}c=r[M].offset;r[M].version=""+K[c]+K[c+1]+K[c+2]+K[c+3];var J=s(K[c+18],K[c+19]);this.metrics.quadsize=J;M=E("hhea");if(M===false){return}c=r[M].offset;r[M].version=""+K[c]+K[c+1]+K[c+2]+K[c+3];this.metrics.ascent=x(K[c+4],K[c+5])/J;this.metrics.descent=x(K[c+6],K[c+7])/J;this.metrics.leading=x(K[c+8],K[c+9])/J;M=E("OS/2");if(M===false){return}c=r[M].offset;r[M].version=""+K[c]+K[c+1];this.metrics.weightclass=s(K[c+4],K[c+5]);M=E("cmap");if(M===false){return}c=r[M].offset;r[M].version=""+K[c]+K[c+1];t=s(K[c+2],K[c+3]);var D,L,o,C,k,B=false;for(var D=0;D<t;D++){L=c+4+D*8;o=s(K[L],K[L+1]);C=s(K[L+2],K[L+3]);k=I(K[L+4],K[L+5],K[L+6],K[L+7]);if(o===3&&C===1){B=k}}var f="A";if(B!==false){c+=B;j=s(K[c],K[c+1]);if(j===4){var d=s(K[c+6],K[c+7])/2;var n=function(e){return[9,10,11,12,13,32,133,160,5760,6158,8192,8193,8194,8195,8196,8197,8198,8199,8200,8201,8202,8232,8233,8239,8287,12288].indexOf(e)===-1};var z=c+14,F=c+14+2*d,y=false;for(;z<F;z+=2){y=s(K[z],K[z+1]);if(n(y)){break}y=false}if(y!==false){f=String.fromCharCode(y);var H=-(y-1)+65536;var G=btoa(w(0)+g(y)+g(65535)+g(0)+g(y)+g(65535)+g(H)+g(1));this.base64=this.base64.substring(0,380)+G+this.base64.substring(380+G.length)}}}this.bootstrapValidation(f,false)};b.prototype.bootstrapValidation=function(d,i){var e=this.fontFamily+" testfont";var g=document.createElement("style");g.setAttribute("type","text/css");g.innerHTML="@font-face {\n  font-family: '"+e+"';\n  src: url('data:application/x-font-ttf;base64,"+this.base64+"')\n       format('truetype');}";document.head.appendChild(g);var k=false;if(!this.systemfont){k=this.toStyleNode();document.head.appendChild(k)}var m=document.createElement("p");m.style.cssText="position: absolute; top: 0; left: 0; opacity: 0;";m.style.fontFamily="'"+this.fontFamily+"', '"+e+"'";m.innerHTML=d+d+d+d+d+d+d+d+d+d;document.body.appendChild(m);if(!document.defaultView.getComputedStyle){this.onload();error("Error: document.defaultView.getComputedStyle is not supported by this browser.\nConsequently, Font.onload() cannot be trusted.")}else{var l=this.systemfont?1000:this.metrics.quadsize;var f=document.createElement("canvas");f.width=l;f.height=l;this.canvas=f;var c=f.getContext("2d");c.font="1em '"+this.fontFamily+"'";c.fillStyle="white";c.fillRect(-1,-1,l+2,l+2);c.fillStyle="black";c.fillText("test text",50,l/2);this.context=c;var h=this;var j=function(){h.validate(m,g,k,h,i)};setTimeout(j,50)}};b.prototype.processSystemFont=function(){this.systemfont=true;this.metrics=false;this.bootstrapValidation("A",1000)};b.prototype.loadFont=function(){var c=this;if(this.url.indexOf(".")===-1){setTimeout(function(){c.processSystemFont()},10);return}var d=new XMLHttpRequest();d.open("GET",c.url,true);d.responseType="arraybuffer";d.onload=function(e){var f=d.response;if(f){c.data=new Uint8Array(f);c.ondownloaded()}else{c.onerror("Error downloading font resource from "+c.url)}};d.send(null)};b.prototype.styleNode=false;b.prototype.toStyleNode=function(){if(this.styleNode){return this.styleNode}this.styleNode=document.createElement("style");this.styleNode.type="text/css";var c="@font-face {\n";c+="  font-family: '"+this.fontFamily+"';\n";c+="  src: url('"+this.url+"') format('"+this.format+"');\n";c+="}";this.styleNode.innerHTML=c;return this.styleNode};b.prototype.measureText=function(c,j){if(!this.loaded){error("measureText() was called while the font was not yet loaded");return false}this.context.font=j+"px '"+this.fontFamily+"'";var g=this.context.measureText(c);g.fontsize=j;g.ascent=0;g.descent=0;g.bounds={minx:0,maxx:g.width,miny:0,maxy:0};g.height=0;var d=[],f=g.width/this.metrics.quadsize;if(f<=1){d.push(c)}else{d.push(c)}var h=d.length,e;for(e=0;e<h;e++){this.measureSegment(d[e],j,g)}return g};b.prototype.measureSegment=function(o,d,D){var x=function(h,i){return document.defaultView.getComputedStyle(h,null).getPropertyValue(i)};var F;var s=document.createElement("div");s.style.position="absolute";s.style.opacity=0;s.style.font=d+"px '"+this.fontFamily+"'";var c=10;s.innerHTML=o;for(F=1;F<c;F++){s.innerHTML+="<br/>"+o}document.body.appendChild(s);D.leading=1.2*d;var l=x(s,"height");l=l.replace("px","");if(l>=d*c){D.leading=(l/c)|0}document.body.removeChild(s);if(/^\s*$/.test(o)){return D}var f=this.canvas,C=this.context,r=this.systemfont?1000:this.metrics.quadsize,t=r,H=r,y=r/2,v=50,e=(r-D.width)/2;if(e!==(e|0)){e=e|0}C.fillStyle="white";C.fillRect(-v,-v,t+2*v,H+2*v);C.fillStyle="black";C.fillText(o,e,y);var B=(D.width+v)|0,A=4*d,u=e-v/2,z=y-A/2,m=C.getImageData(u,z,B,A).data;var F=0,E=0,q=B*4,G=m.length,I=A/2;while(++F<G&&m[F]===255){}var p=(F/q)|0;F=G-1;while(--F>0&&m[F]===255){}var J=(F/q)|0;for(F=0,E=0;E<B&&m[F]===255;){F+=q;if(F>=G){E++;F=(F-G)+4}}var k=E;var n=1;for(F=G-3,E=0;E<B&&m[F]===255;){F-=q;if(F<0){E++;F=(G-3)-(n++)*4}}var g=B-E;D.ascent=(I-p);D.descent=(J-I);D.bounds={minx:k-(v/2),maxx:g-(v/2),miny:-D.descent,maxy:D.ascent};D.height=1+(J-p);return D};Object.defineProperty(b.prototype,"src",{set:function(c){this.url=c;this.loadFont()}});a.Font=b}(window));